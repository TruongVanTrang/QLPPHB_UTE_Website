<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Doanh Nghiệp - PCTSV</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- GIAO DIỆN PCTSV (GREEN THEME) --- */
        body { 
            background: linear-gradient(135deg, #134E5E 0%, #71B280 100%);
            font-family: 'Segoe UI', sans-serif;
            min-height: 100vh;
        }

        .sidebar {
            min-height: 100vh;
            background: #1a3c34;
            color: white;
            width: 250px;
            position: fixed;
            top: 0; left: 0; z-index: 1000;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .brand-logo {
            padding: 20px;
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            background: #14302a;
            border-bottom: 1px solid #2a5c52;
        }

        .sidebar .nav-link {
            color: #a8d5cc;
            padding: 15px 20px;
            display: block;
            text-decoration: none;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: #2a5c52;
            color: white;
            border-left: 4px solid #71B280;
        }

        .main-wrapper {
            margin-left: 250px;
            padding: 30px;
        }

        .admin-header {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: none;
        }

        /* Form Styles */
        .form-label { font-weight: 600; color: #134E5E; }
        .stt-label { color: #dc3545; font-weight: 900; margin-right: 5px; }

        .btn-action { width: 35px; height: 35px; padding: 0; display: inline-flex; align-items: center; justify-content: center; border-radius: 5px; }
        .btn-edit { background: #ffc107; color: #000; border: none; }
        .btn-delete { background: #dc3545; color: #fff; border: none; }
    </style>
</head>
<body>

    <div id="sidebar-container"></div>

    <div class="main-wrapper">

        <div class="admin-header">
            <h4 class="m-0 fw-bold text-secondary"><i class="fas fa-building me-2 text-success"></i>Quản Lý Doanh Nghiệp</h4>
            <div class="dropdown">
                <a href="#" class="text-decoration-none text-dark fw-bold">
                    <img src="https://via.placeholder.com/30" class="rounded-circle me-1"> Cán bộ CTSV
                </a>
            </div>
        </div>

        <button class="btn btn-success mb-3 fw-bold shadow-sm" onclick="openAddForm()">
            <i class="fas fa-plus-circle me-2"></i>Thêm Doanh Nghiệp Mới
        </button>

        <div class="card d-none border-top border-4 border-success" id="formCard">
            <h5 class="text-success fw-bold mb-4 border-bottom pb-2" id="formTitle">
                <i class="fas fa-edit me-2"></i>Nhập thông tin Doanh nghiệp
            </h5>

            <form id="formDoanhNghiep">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label"><span class="stt-label">1.</span>Mã Doanh Nghiệp <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="maDN" placeholder="VD: DN001" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label"><span class="stt-label">2.</span>Tên Doanh Nghiệp <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="tenDN" placeholder="VD: FPT Software" required>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label"><span class="stt-label">3.</span>Mã số thuế</label>
                        <input type="text" class="form-control" id="maSoThue" placeholder="VD: 0101234567">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label"><span class="stt-label">4.</span>Email liên hệ <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="emailDN" placeholder="contact@company.com" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label"><span class="stt-label">5.</span>Số điện thoại</label>
                        <input type="text" class="form-control" id="sdtDN" placeholder="090...">
                    </div>
                    
                    <div class="col-12">
                        <label class="form-label"><span class="stt-label">6.</span>Địa chỉ trụ sở</label>
                        <input type="text" class="form-control" id="diaChiDN" placeholder="VD: Khu Công nghệ cao, Đà Nẵng">
                    </div>
                </div>

                <div class="mt-4 text-end">
                    <button type="button" class="btn btn-secondary me-2" onclick="closeForm()">Hủy bỏ</button>
                    <button type="submit" class="btn btn-success fw-bold px-4"><i class="fas fa-save me-1"></i>Lưu dữ liệu</button>
                </div>
            </form>
        </div>

        <div class="card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="text-secondary fw-bold m-0"><i class="fas fa-list me-2"></i>Danh sách Doanh nghiệp</h5>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th><span class="stt-label">7.</span>Mã DN</th>
                            <th><span class="stt-label">8.</span>Tên Doanh Nghiệp</th>
                            <th><span class="stt-label">9.</span>MST</th>
                            <th><span class="stt-label">10.</span>Email</th>
                            <th><span class="stt-label">11.</span>SĐT</th>
                            <th><span class="stt-label">12.</span>Địa chỉ</th>
                            <th class="text-center">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="tableDoanhNghiep">
                        </tbody>
                </table>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- Sidebar Logic ---
        const MENUS = {
            ADMIN: [],
            PCTSV: [
                { title: 'QL Doanh nghiệp', url: 'QLDN.html', icon: 'fa-building' }, // Active
                { title: 'Duyệt Điểm HĐ', url: 'DuyetDHD.html', icon: 'fa-tasks' },
                { title: 'Duyệt HB Khuyến khích', url: 'HBKK.html', icon: 'fa-star' },
                { title: 'Duyệt HB Thử thách', url: 'HBTT.html', icon: 'fa-hand-holding-heart' },
                { title: 'Duyệt HB Doanh nghiệp', url: 'HBDN.html', icon: 'fa-briefcase' },
                { title: 'Xử lý Khiếu nại', url: 'XuLyKhieuNai.html', icon: 'fa-gavel' }
            ]
        };

        function createSidebar(role, activePage) {
            const container = document.getElementById('sidebar-container');
            if (!container) return;
            const menuItems = MENUS[role] || [];
            let html = `<nav class="sidebar"><div class="brand-logo"><i class="fas fa-university me-2"></i> P. CÔNG TÁC SV</div><div class="nav flex-column">`;
            menuItems.forEach(item => {
                const isActive = activePage.includes(item.url) ? 'active' : '';
                html += `<a href="${item.url}" class="nav-link ${isActive}"><i class="fas ${item.icon} me-2"></i> ${item.title}</a>`;
            });
            html += `</div><div class="mt-auto p-3 border-top border-secondary position-absolute bottom-0 w-100"><a href="../TrangChu/index.html" class="nav-link text-white"><i class="fas fa-sign-out-alt me-2"></i> Thoát</a></div></nav>`;
            container.innerHTML = html;
        }
        createSidebar('PCTSV', 'QLDN.html');

        // --- DỮ LIỆU MẪU (Giả lập DB) ---
        let db_DoanhNghiep = [
            { MaDN: 'DN001', TenDN: 'FPT Software', MaSoThue: '0101234567', Email: 'hr@fsoft.com.vn', SDT: '02363123456', DiaChi: 'FPT Complex, Đà Nẵng' },
            { MaDN: 'DN002', TenDN: 'Viettel Telecom', MaSoThue: '0100109106', Email: 'tuyendung@viettel.com.vn', SDT: '18008098', DiaChi: 'Hải Châu, Đà Nẵng' }
        ];

        let editIndex = null;

        // Render Bảng
        function renderTable() {
            const tbody = document.getElementById('tableDoanhNghiep');
            tbody.innerHTML = '';
            
            db_DoanhNghiep.forEach((dn, i) => {
                tbody.innerHTML += `
                <tr>
                    <td class="fw-bold text-primary">${dn.MaDN}</td>
                    <td class="fw-bold">${dn.TenDN}</td>
                    <td>${dn.MaSoThue}</td>
                    <td>${dn.Email}</td>
                    <td>${dn.SDT}</td>
                    <td><small>${dn.DiaChi}</small></td>
                    <td class="text-center">
                        <button class="btn-action btn-edit me-1" onclick="openEditForm(${i})"><i class="fas fa-edit"></i></button>
                        <button class="btn-action btn-delete" onclick="deleteDN(${i})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        // Các hàm xử lý Form
        function openAddForm() {
            document.getElementById('formDoanhNghiep').reset();
            document.getElementById('maDN').disabled = false; // Mở khóa nhập Mã
            document.getElementById('formTitle').innerHTML = '<i class="fas fa-plus-circle me-2"></i>Thêm Doanh Nghiệp Mới';
            
            editIndex = null;
            document.getElementById('formCard').classList.remove("d-none");
            document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
        }

        function openEditForm(index) {
            const dn = db_DoanhNghiep[index];
            
            // Fill data
            document.getElementById('maDN').value = dn.MaDN;
            document.getElementById('tenDN').value = dn.TenDN;
            document.getElementById('maSoThue').value = dn.MaSoThue;
            document.getElementById('emailDN').value = dn.Email;
            document.getElementById('sdtDN').value = dn.SDT;
            document.getElementById('diaChiDN').value = dn.DiaChi;

            document.getElementById('maDN').disabled = true; // Khóa Mã (PK)
            document.getElementById('formTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Cập nhật thông tin Doanh Nghiệp';
            
            editIndex = index;
            document.getElementById('formCard').classList.remove("d-none");
            document.getElementById('formCard').scrollIntoView({ behavior: 'smooth' });
        }

        function closeForm() {
            document.getElementById('formCard').classList.add("d-none");
        }

        function deleteDN(index) {
            if(confirm('Bạn có chắc muốn xóa doanh nghiệp này?')) {
                db_DoanhNghiep.splice(index, 1);
                renderTable();
            }
        }

        // Submit Form
        document.getElementById('formDoanhNghiep').onsubmit = function(e) {
            e.preventDefault();

            const data = {
                MaDN: document.getElementById('maDN').value.trim(),
                TenDN: document.getElementById('tenDN').value.trim(),
                MaSoThue: document.getElementById('maSoThue').value.trim(),
                Email: document.getElementById('emailDN').value.trim(),
                SDT: document.getElementById('sdtDN').value.trim(),
                DiaChi: document.getElementById('diaChiDN').value.trim()
            };

            if (editIndex === null) {
                // Thêm mới (Check trùng Mã)
                if (db_DoanhNghiep.some(x => x.MaDN === data.MaDN)) {
                    alert("Mã Doanh nghiệp này đã tồn tại!");
                    return;
                }
                db_DoanhNghiep.push(data);
                alert("✅ Đã thêm doanh nghiệp thành công!");
            } else {
                // Cập nhật
                db_DoanhNghiep[editIndex] = data;
                alert("✅ Đã cập nhật thông tin!");
            }

            closeForm();
            renderTable();
        };

        // Init
        renderTable();
    </script>

</body>
</html>