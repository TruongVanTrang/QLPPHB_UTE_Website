<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra C·ª©u L·ªãch S·ª≠ H·ªçc B·ªïng - Khoa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- GIAO DI·ªÜN CHU·∫®N KHOA (CYAN THEME) --- */
        body { 
            background: linear-gradient(135deg, #0dcaf0 0%, #0099cc 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        /* Sidebar Menu */
        .sidebar {
            min-height: 100vh; background: #004d61; color: white; width: 250px;
            position: fixed; top: 0; left: 0; z-index: 1000;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .brand-logo { padding: 20px; font-size: 1.5rem; font-weight: bold; text-align: center; background: #003a4d; border-bottom: 1px solid #0dcaf0; }
        .sidebar .nav-link { color: #a8eeff; padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); text-decoration: none; display: block; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: #007a99; color: white; border-left: 4px solid #0dcaf0; }

        .main-wrapper { margin-left: 250px; padding: 30px; transition: all 0.3s; }
        .admin-header { background: white; padding: 15px 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 30px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }

        .card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card h2 { color: #0099cc; margin-bottom: 20px; font-size: 1.5em; border-bottom: 3px solid #0dcaf0; padding-bottom: 10px; }

        /* Filter Section */
        .filter-section { background: #e0faff; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; border: 1px solid #b3e5fc; }
        .filter-select { padding: 8px 12px; border: 1px solid #81d4fa; border-radius: 5px; min-width: 250px; outline: none; }

        /* Table */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th { background: #f0fdff; font-weight: bold; color: #007a99; padding: 12px; text-align: left; border-bottom: 2px solid #0dcaf0; }
        .data-table td { padding: 12px; border-bottom: 1px solid #e0e0e0; font-size: 0.95rem; }
        .data-table tr:hover { background: #e0f7fa; }

        .btn-view { background: #0dcaf0; color: white; border: none; padding: 6px 12px; border-radius: 5px; font-size: 13px; font-weight: bold; transition: 0.2s; }
        .btn-view:hover { background: #0099cc; color: white; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1050; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 1000px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; margin-left: 100px;}
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        
        .hb-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; color: white; }
        .bg-kk { background: #28a745; } /* Khuy·∫øn kh√≠ch */
        .bg-tt { background: #fd7e14; } /* Th·ª≠ th√°ch */
        .bg-dn { background: #6f42c1; } /* Doanh nghi·ªáp */

        /* STT Label */
        .stt-label { color: #dc3545; font-weight: 900; margin-right: 5px; }
    </style>
</head>
<body>

    <div id="sidebar-container"></div>

    <div class="main-wrapper">
        <header class="admin-header">
            <h4 class="m-0 fw-bold text-secondary">
                <i class="fas fa-search me-2 text-info"></i>Tra C·ª©u L·ªãch S·ª≠ H·ªçc B·ªïng
            </h4>
            <div class="dropdown">
                <a href="#" class="text-decoration-none text-dark dropdown-toggle" data-bs-toggle="dropdown">
                    <img src="https://via.placeholder.com/30" class="rounded-circle me-1">
                     <b>Gi√°o v·ª• Khoa CNTT</b>
                </a>
            </div>
        </header>

        <div class="card">
            <h2>üîç Tra C·ª©u Sinh Vi√™n Theo Khoa</h2>
            
            <div class="filter-section">
                <label><i class="fas fa-filter me-2"></i><span class="stt-label">1.</span>Ch·ªçn Khoa:</label>
                <select id="khoaFilter" class="filter-select" onchange="filterStudents()">
                    <option value="">-- T·∫•t c·∫£ c√°c khoa --</option>
                    <option value="CNTT">C√¥ng Ngh·ªá Th√¥ng Tin (CNTT)</option>
                    <option value="XD">K·ªπ thu·∫≠t X√¢y D·ª±ng (XD)</option>
                    <option value="CK">C∆° Kh√≠ (CK)</option>
                </select>
            </div>

            <div style="overflow-x: auto;">
                <table class="data-table" id="studentTable">
                    <thead>
                        <tr>
                            <th><span class="stt-label">2.</span>M√£ SV</th>
                            <th><span class="stt-label">3.</span>H·ªç T√™n</th>
                            <th><span class="stt-label">4.</span>L·ªõp</th>
                            <th><span class="stt-label">1.</span>Khoa</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 class="text-info mb-4 border-bottom pb-2">H·ªì S∆° Sinh Vi√™n</h3>
            
            <div id="studentDetail" class="mb-4 row">
                </div>
            
            <h4 class="text-secondary mb-3"><i class="fas fa-history me-2"></i>L·ªãch S·ª≠ Nh·∫≠n H·ªçc B·ªïng (View: vw_DanhSachHocBongDaDuyet)</h4>
            <div style="overflow-x: auto;">
                <table class="data-table" id="hbTable">
                    <thead>
                        <tr>
                            <th><span class="stt-label">5.</span>NƒÉm H·ªçc</th>
                            <th><span class="stt-label">6.</span>T√™n H·ªçc B·ªïng</th>
                            <th><span class="stt-label">7.</span>Lo·∫°i HB</th>
                            <th><span class="stt-label">8.</span>S·ªë Ti·ªÅn</th>
                            <th><span class="stt-label">9.</span>Ng√†y X√©t</th>
                            <th><span class="stt-label">10.</span>Tr·∫°ng Th√°i</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Sidebar Script (Gi·ªØ nguy√™n)
        const MENUS = { ADMIN: [], PCTSV: [], KHOA: [{title:'QL ƒêi·ªÉm R√®n Luy·ªán',url:'QL_DRL.html',icon:'fa-running'},{title:'Tra c·ª©u L·ªãch s·ª≠ HB',url:'QL_LSHB.html',icon:'fa-search'}] };
        function createSidebar(role, activePage) {
            const container = document.getElementById('sidebar-container');
            let html = `<nav class="sidebar"><div class="brand-logo"><i class="fas fa-chalkboard-teacher me-2"></i>GI√ÅO V·ª§ KHOA</div><div class="nav flex-column">`;
            MENUS[role].forEach(item => { const isActive = activePage.includes(item.url) ? 'active' : ''; html += `<a href="${item.url}" class="nav-link ${isActive}"><i class="fas ${item.icon} me-2"></i>${item.title}</a>`; });
            html += `</div><div class="mt-auto p-3 border-top border-secondary position-absolute bottom-0 w-100"><a href="../TrangChu/index.html" class="nav-link text-white"><i class="fas fa-sign-out-alt me-2"></i>Tho√°t</a></div></nav>`;
            container.innerHTML = html;
        }
        createSidebar('KHOA', 'QL_LSHB.html');
    </script>

    <script>
        // --- 1. D·ªÆ LI·ªÜU SINH VI√äN (Table SinhVien) ---
        const students = [
            { MaSV: 'SV001', HoTen: 'Nguy·ªÖn VƒÉn An', MaLop: '21DTHC1', MaKhoa: 'CNTT' },
            { MaSV: 'SV002', HoTen: 'L√™ Th·ªã B√¨nh', MaLop: '21DTHC1', MaKhoa: 'CNTT' },
            { MaSV: 'SV003', HoTen: 'Ph·∫°m VƒÉn Ch√≠', MaLop: '21CK01', MaKhoa: 'CK' },
            { MaSV: 'SV007', HoTen: 'ƒêinh Th·ªã Lan', MaLop: '21DTHX1', MaKhoa: 'XD' },
            { MaSV: 'SV008', HoTen: 'Phan VƒÉn Minh', MaLop: '21DTHC1', MaKhoa: 'CNTT' }
        ];

        // --- 2. D·ªÆ LI·ªÜU L·ªäCH S·ª¨ H·ªåC B·ªîNG (View: vw_DanhSachHocBongDaDuyet) ---
        // G·ªìm c√°c tr∆∞·ªùng: MaSV, NamHoc, TenHocBong, LoaiHocBong, SoTien, NgayXet, TrangThai
        const lichSuData = [
            { MaSV: 'SV001', NamHoc: '2024-2025', TenHocBong: 'H·ªçc b·ªïng Khuy·∫øn kh√≠ch A', LoaiHocBong: 'KhuyenKhich', SoTien: 5000000, NgayXet: '2025-05-20', TrangThai: 'ƒê·∫°t' },
            { MaSV: 'SV001', NamHoc: '2024-2025', TenHocBong: 'H·ªçc b·ªïng FPT Talent', LoaiHocBong: 'DoanhNghiep', SoTien: 10000000, NgayXet: '2025-05-25', TrangThai: 'ƒê·∫°t' },
            { MaSV: 'SV002', NamHoc: '2024-2025', TenHocBong: 'H·ªçc b·ªïng Khuy·∫øn kh√≠ch A', LoaiHocBong: 'KhuyenKhich', SoTien: 5000000, NgayXet: '2025-05-20', TrangThai: 'ƒê·∫°t' },
            { MaSV: 'SV003', NamHoc: '2024-2025', TenHocBong: 'H·ªçc b·ªïng Th·ª≠ th√°ch', LoaiHocBong: 'ThuThach', SoTien: 2000000, NgayXet: '2024-09-15', TrangThai: 'ƒê·∫°t' },
            { MaSV: 'SV008', NamHoc: '2023-2024', TenHocBong: 'H·ªçc b·ªïng Khuy·∫øn kh√≠ch B', LoaiHocBong: 'KhuyenKhich', SoTien: 3000000, NgayXet: '2024-01-15', TrangThai: 'ƒê·∫°t' }
        ];

        // --- RENDER TABLE ---
        function renderTable(filterKhoa = "") {
            const tbody = document.querySelector('#studentTable tbody');
            tbody.innerHTML = '';
            
            // L·ªçc theo Khoa
            const filtered = filterKhoa ? students.filter(s => s.MaKhoa === filterKhoa) : students;
            
            filtered.forEach(sv => {
                // Mapping t√™n khoa hi·ªÉn th·ªã
                let tenKhoaHienThi = sv.MaKhoa === "CNTT" ? "C√¥ng Ngh·ªá S·ªë" : (sv.MaKhoa === "CK" ? "C∆° Kh√≠" : "X√¢y D·ª±ng");

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="fw-bold">${sv.MaSV}</td>
                    <td>${sv.HoTen}</td>
                    <td>${sv.MaLop}</td>
                    <td>${tenKhoaHienThi}</td>
                    <td><button class="btn-view" onclick="viewDetail('${sv.MaSV}')"><i class="fas fa-eye me-1"></i>Xem L·ªãch S·ª≠</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterStudents() {
            const khoa = document.getElementById('khoaFilter').value;
            renderTable(khoa);
        }

        // --- VIEW DETAIL MODAL ---
        window.viewDetail = function(maSV) {
    const sv = students.find(s => s.MaSV === maSV);
    const hbList = lichSuData.filter(h => h.MaSV === maSV);

    document.getElementById('studentDetail').innerHTML = `
        <div class="col-md-6"><p><strong><span class="stt-label">2.</span>M√£ SV:</strong> ${sv.MaSV}</p></div>
        <div class="col-md-6"><p><strong><span class="stt-label">3.</span>H·ªç t√™n:</strong> ${sv.HoTen}</p></div>
        <div class="col-md-6"><p><strong><span class="stt-label">4.</span>L·ªõp:</strong> ${sv.MaLop}</p></div>
        <div class="col-md-6"><p><strong>T·ªïng ti·ªÅn ƒë√£ nh·∫≠n:</strong> <span class="text-danger fw-bold">${formatCurrency(hbList.reduce((acc, curr) => acc + curr.SoTien, 0))}</span></p></div>
    `;

        const hbBody = document.querySelector('#hbTable tbody');
        hbBody.innerHTML = '';
        
        if(hbList.length === 0) {
            hbBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Sinh vi√™n n√†y ch∆∞a nh·∫≠n ƒë∆∞·ª£c h·ªçc b·ªïng n√†o.</td></tr>';
        } else {
            hbList.forEach(hb => {
                let badgeClass = "";
                let tenLoai = "";
                
                if(hb.LoaiHocBong === "KhuyenKhich") { badgeClass = "bg-kk"; tenLoai = "Khuy·∫øn kh√≠ch"; }
                else if(hb.LoaiHocBong === "ThuThach") { badgeClass = "bg-tt"; tenLoai = "Th·ª≠ th√°ch"; }
                else { badgeClass = "bg-dn"; tenLoai = "Doanh nghi·ªáp"; }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${hb.NamHoc}</td>
                    <td class="fw-bold text-primary">${hb.TenHocBong}</td>
                    <td><span class="hb-badge ${badgeClass}">${tenLoai}</span></td>
                    <td class="text-danger fw-bold">${formatCurrency(hb.SoTien)}</td>
                    <td>${hb.NgayXet}</td>
                    <td><span class="badge bg-success">${hb.TrangThai}</span></td>
                `;
                hbBody.appendChild(tr);
            });
        }

        document.getElementById('detailModal').classList.add('active');
    }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        window.closeModal = function() {
            document.getElementById('detailModal').classList.remove('active');
        }

        window.onclick = function(e) {
            if (e.target === document.getElementById('detailModal')) closeModal();
        }
        
        renderTable();
    </script>
</body>
</html>