<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra C·ª©u L·ªãch S·ª≠ H·ªçc B·ªïng - Khoa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. GIAO DI·ªÜN CHU·∫®N KHOA (CYAN THEME) --- */
        body { 
            background: linear-gradient(135deg, #0dcaf0 0%, #0099cc 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        /* Sidebar Menu */
        .sidebar {
            min-height: 100vh;
            background: #004d61;
            color: white;
            width: 250px;
            position: fixed;
            top: 0; left: 0;
            z-index: 1000;
            transition: all 0.3s;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .brand-logo {
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            background: #003a4d;
            border-bottom: 1px solid #0dcaf0;
        }

        .sidebar .nav-link {
            color: #a8eeff;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            text-decoration: none;
            display: block;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: #fff;
            background: #007a99;
            border-left: 4px solid #0dcaf0;
        }

        /* Main Content */
        .main-wrapper {
            margin-left: 250px;
            padding: 30px;
            transition: all 0.3s;
        }

        /* Header */
        .admin-header {
            background: white;
            padding: 15px 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- 2. CSS C√ÅC TH√ÄNH PH·∫¶N CON --- */
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .card h2 {
            color: #0099cc;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #0dcaf0;
            padding-bottom: 10px;
        }

        /* Filter Section */
        .filter-section {
            background: #e0faff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #b3e5fc;
        }
        .filter-section label { font-weight: bold; color: #006064; }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #81d4fa;
            border-radius: 5px;
            min-width: 250px;
            outline: none;
        }
        .filter-select:focus { border-color: #0099cc; box-shadow: 0 0 0 3px rgba(0, 153, 204, 0.2); }

        /* Table */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th { 
            background: #f0fdff; 
            font-weight: bold; 
            color: #007a99; 
            padding: 12px; text-align: left; 
            border-bottom: 2px solid #0dcaf0; 
        }
        .data-table td { padding: 12px; border-bottom: 1px solid #e0e0e0; font-size: 0.95rem; }
        .data-table tr:hover { background: #e0f7fa; }

        /* Buttons & Modal */
        .btn-view {
            background: #0dcaf0;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 13px;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-view:hover { background: #0099cc; color: white; }

        /* Modal Styles */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1050; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 1000px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; margin-left: 100px;}
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        .close-modal:hover { color: #dc3545; }

        /* Student Detail Info */
        .student-info p { margin-bottom: 8px; font-size: 1rem; }
        .student-info strong { color: #006064; width: 120px; display: inline-block; }

        /* Badge H·ªçc B·ªïng */
        .hb-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; color: white; }
        .bg-kk { background: #28a745; }
        .bg-tt { background: #fd7e14; }
        .bg-dn { background: #6f42c1; }
    </style>
</head>
<body>

    <div id="sidebar-container"></div>

    <div class="main-wrapper">
        
        <header class="admin-header">
            <h4 class="m-0 fw-bold text-secondary">
                <i class="fas fa-search me-2 text-info"></i>Tra C·ª©u L·ªãch S·ª≠ H·ªçc B·ªïng
            </h4>
            <div class="dropdown">
                <a href="#" class="text-decoration-none text-dark dropdown-toggle" data-bs-toggle="dropdown">
                    <img src="https://via.placeholder.com/30" class="rounded-circle me-1">
                    <span>Xin ch√†o, <b>Gi√°o v·ª• Khoa</b></span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item text-danger" href="#">ƒêƒÉng xu·∫•t</a></li>
                </ul>
            </div>
        </header>

        <div class="card">
            <h2>üîç Tra C·ª©u Sinh Vi√™n Theo Khoa</h2>
            
            <div class="filter-section">
                <label><i class="fas fa-filter me-2"></i>Ch·ªçn Khoa:</label>
                <select id="khoaFilter" class="filter-select" onchange="filterStudents()">
                    <option value="">-- T·∫•t c·∫£ c√°c khoa --</option>
                    <option value="CNTT">C√¥ng Ngh·ªá Th√¥ng Tin (CNTT)</option>
                    <option value="XD">X√¢y D·ª±ng (XD)</option>
                    <option value="KTCK">K·ªπ Thu·∫≠t C∆° Kh√≠ (KTCK)</option>
                </select>
            </div>

            <div style="overflow-x: auto;">
                <table class="data-table" id="studentTable">
                    <thead>
                        <tr>
                            <th>M√£ SV</th>
                            <th>H·ªç T√™n</th>
                            <th>L·ªõp</th>
                            <th>Khoa</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 class="text-info mb-4 border-bottom pb-2">H·ªì S∆° Sinh Vi√™n</h3>
            
            <div id="studentDetail" class="student-info mb-4"></div>
            
            <h4 class="text-secondary mb-3"><i class="fas fa-history me-2"></i>L·ªãch S·ª≠ Nh·∫≠n H·ªçc B·ªïng</h4>
            <div style="overflow-x: auto;">
                <table class="data-table" id="hbTable">
                    <thead>
                        <tr>
                            <th>NƒÉm</th>
                            <th>T√™n H·ªçc B·ªïng</th>
                            <th>Lo·∫°i</th>
                            <th>Gi√° Tr·ªã</th>
                            <th>Ng√†y C·∫•p</th>
                            <th>Tr·∫°ng Th√°i</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const MENUS = {
            ADMIN: [
                { title: 'T·ªïng quan', url: 'Dashboard.html', icon: 'fa-tachometer-alt' },
                { title: 'Ng∆∞·ªùi d√πng', url: 'nguoidung.html', icon: 'fa-users-cog' },
                { title: 'NƒÉm h·ªçc', url: 'namhoc.html', icon: 'fa-calendar-alt' },
                { title: 'H·ªçc b·ªïng', url: 'hocbong.html', icon: 'fa-hand-holding-usd' }
            ],
            PCTSV: [
                { title: 'QL Doanh nghi·ªáp', url: 'QLDN.html', icon: 'fa-building' },
                { title: 'Ph√¢n b·ªï ng√¢n s√°ch', url: 'PBNS.html', icon: 'fa-chart-pie' },
                { title: 'Duy·ªát ƒêi·ªÉm Hƒê', url: 'DuyetDHD.html', icon: 'fa-tasks' },
                { title: 'Duy·ªát HB Khuy·∫øn kh√≠ch', url: 'HBKK.html', icon: 'fa-star' },
                { title: 'Duy·ªát HB Th·ª≠ th√°ch', url: 'HBTT.html', icon: 'fa-hand-holding-heart' },
                { title: 'Duy·ªát HB Doanh nghi·ªáp', url: 'HBDN.html', icon: 'fa-briefcase' }
            ],
            PDAOTAO: [
                { title: 'QL H·ªì s∆° Sinh vi√™n', url: 'QL_HSSV.html', icon: 'fa-id-card' },
                { title: 'QL ƒêi·ªÉm GPA', url: 'QL_GPA.html', icon: 'fa-file-excel' }
            ],
            KHOA: [
                { title: 'QL ƒêi·ªÉm R√®n Luy·ªán', url: 'QL_DRL.html', icon: 'fa-running' },
                { title: 'Tra c·ª©u L·ªãch s·ª≠ HB', url: 'QL_LSHB.html', icon: 'fa-search' }
            ]
        };

        function createSidebar(role, activePage) {
            const container = document.getElementById('sidebar-container');
            if (!container) return;

            const menuItems = MENUS[role] || [];
            
            // C·∫•u h√¨nh ri√™ng cho KHOA
            const brandTitle = 'GI√ÅO V·ª§ KHOA';
            const brandIcon = 'fa-chalkboard-teacher';

            let html = `
                <nav class="sidebar">
                    <div class="brand-logo">
                        <i class="fas ${brandIcon} me-2"></i> ${brandTitle}
                    </div>
                    <div class="nav flex-column">
            `;

            menuItems.forEach(item => {
                const isActive = activePage.includes(item.url) ? 'active' : '';
                html += `
                    <a href="${item.url}" class="nav-link ${isActive}">
                        <i class="fas ${item.icon} me-2"></i> ${item.title}
                    </a>
                `;
            });

            html += `
                    </div>
                    <div class="mt-auto p-3 border-top border-secondary" style="position: absolute; bottom: 0; width: 100%;">
                        <a href="../TrangChu/index.html" class="nav-link text-white">
                            <i class="fas fa-sign-out-alt me-2"></i> Tho√°t
                        </a>
                    </div>
                </nav>
            `;
            container.innerHTML = html;
        }

        // G·ªçi h√†m t·∫°o Sidebar cho vai tr√≤ KHOA
        createSidebar('KHOA', 'QL_LSHB.html');
    </script>

    <script>
        // D·ªØ li·ªáu m·∫´u
        const students = [
            ...Array.from({length: 20}, (_, i) => ({
                maSV: `SV21${String(1001+i).padStart(4,'0')}`,
                hoTen: `Nguy·ªÖn VƒÉn ${String.fromCharCode(65+i)}`,
                lop: ["CNTT21A", "CNTT21B", "CNTT21C"][i%3],
                khoa: "CNTT"
            })),
            ...Array.from({length: 20}, (_, i) => ({
                maSV: `SV22${String(2001+i).padStart(4,'0')}`,
                hoTen: `Tr·∫ßn VƒÉn ${String.fromCharCode(65+i)}`,
                lop: ["XD22A", "XD22B", "XD22C"][i%3],
                khoa: "XD"
            })),
            ...Array.from({length: 20}, (_, i) => ({
                maSV: `SV23${String(3001+i).padStart(4,'0')}`,
                hoTen: `L√™ Th·ªã ${String.fromCharCode(65+i)}`,
                lop: ["CK23A", "CK23B", "CK23C"][i%3],
                khoa: "KTCK"
            }))
        ];

        const hocbongList = [
            { ten: "H·ªçc b·ªïng Khuy·∫øn kh√≠ch H·ªçc t·∫≠p", loai: "KhuyenKhich", giaTri: "5.000.000ƒë" },
            { ten: "H·ªçc b·ªïng Th·ª≠ th√°ch L·∫≠p tr√¨nh", loai: "ThuThach", giaTri: "10.000.000ƒë" },
            { ten: "H·ªçc b·ªïng Doanh nghi·ªáp Google", loai: "DoanhNghiep", giaTri: "15.000.000ƒë" },
            { ten: "H·ªçc b·ªïng Khuy·∫øn kh√≠ch Nghi√™n c·ª©u", loai: "KhuyenKhich", giaTri: "6.000.000ƒë" },
            { ten: "H·ªçc b·ªïng Doanh nghi·ªáp VinGroup", loai: "DoanhNghiep", giaTri: "12.000.000ƒë" }
        ];

        const lichSuHocBong = {};
        students.forEach(sv => {
            const soLuongHB = Math.floor(Math.random() * 5) + 1; // √çt nh·∫•t 1 HB ƒë·ªÉ demo ƒë·∫πp
            lichSuHocBong[sv.maSV] = Array.from({length: soLuongHB}, () => {
                const hb = hocbongList[Math.floor(Math.random() * hocbongList.length)];
                const nam = 2022 + Math.floor(Math.random() * 4);
                return {
                    nam,
                    ten: hb.ten,
                    loai: hb.loai,
                    giaTri: hb.giaTri,
                    ngayCap: `${Math.floor(Math.random()*28)+1}/${Math.floor(Math.random()*12)+1}/${nam}`,
                    trangThai: Math.random() > 0.2 ? "ƒê√£ c·∫•p" : "ƒêang x√©t"
                };
            });
        });

        function renderTable(filterKhoa = "") {
            const tbody = document.querySelector('#studentTable tbody');
            tbody.innerHTML = '';
            const filtered = filterKhoa ? students.filter(s => s.khoa === filterKhoa) : students;
            
            filtered.forEach(sv => {
                const tenKhoa = sv.khoa === "CNTT" ? "C√¥ng Ngh·ªá Th√¥ng Tin" 
                              : sv.khoa === "XD"   ? "X√¢y D·ª±ng" 
                              : "K·ªπ Thu·∫≠t C∆° Kh√≠";
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${sv.maSV}</strong></td>
                    <td>${sv.hoTen}</td>
                    <td>${sv.lop}</td>
                    <td>${tenKhoa}</td>
                    <td><button class="btn-view" onclick="viewDetail('${sv.maSV}')"><i class="fas fa-eye me-1"></i>Xem</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterStudents() {
            const khoa = document.getElementById('khoaFilter').value;
            renderTable(khoa);
        }

        window.viewDetail = function(maSV) {
            const sv = students.find(s => s.maSV === maSV);
            const hbList = lichSuHocBong[maSV] || [];
            const tenKhoa = sv.khoa === "CNTT" ? "C√¥ng Ngh·ªá Th√¥ng Tin" 
                          : sv.khoa === "XD"   ? "X√¢y D·ª±ng" 
                          : "K·ªπ Thu·∫≠t C∆° Kh√≠";

            document.getElementById('studentDetail').innerHTML = `
                <p><strong>M√£ SV:</strong> ${sv.maSV}</p>
                <p><strong>H·ªç t√™n:</strong> ${sv.hoTen}</p>
                <p><strong>L·ªõp:</strong> ${sv.lop}</p>
                <p><strong>Khoa:</strong> ${tenKhoa}</p>
                <p><strong>T·ªïng HB ƒë√£ nh·∫≠n:</strong> <span class="text-success fw-bold">${hbList.filter(h=>h.trangThai==="ƒê√£ c·∫•p").length} su·∫•t</span></p>
            `;

            const hbBody = document.querySelector('#hbTable tbody');
            hbBody.innerHTML = '';
            hbList.forEach(hb => {
                let loaiHienThi = "", badgeClass = "";
                if(hb.loai === "KhuyenKhich") { loaiHienThi = "Khuy·∫øn kh√≠ch"; badgeClass = "bg-kk"; }
                else if(hb.loai === "ThuThach") { loaiHienThi = "Th·ª≠ th√°ch"; badgeClass = "bg-tt"; }
                else { loaiHienThi = "Doanh nghi·ªáp"; badgeClass = "bg-dn"; }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${hb.nam}</td>
                    <td>${hb.ten}</td>
                    <td><span class="hb-badge ${badgeClass}">${loaiHienThi}</span></td>
                    <td class="text-danger fw-bold">${hb.giaTri}</td>
                    <td>${hb.ngayCap}</td>
                    <td><span class="badge ${hb.trangThai === 'ƒê√£ c·∫•p' ? 'bg-success' : 'bg-warning text-dark'}">${hb.trangThai}</span></td>
                `;
                hbBody.appendChild(tr);
            });

            document.getElementById('detailModal').classList.add('active');
        }

        window.closeModal = function() {
            document.getElementById('detailModal').classList.remove('active');
        }

        window.onclick = function(e) {
            if (e.target === document.getElementById('detailModal')) closeModal();
        }
        
        renderTable();
    </script>
</body>
</html>