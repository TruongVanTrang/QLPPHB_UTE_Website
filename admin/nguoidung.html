<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω T√†i kho·∫£n - UTE Admin</title>
    <style>
        :root { --primary: #8c7a6b; --bg: #d9d2c7; --card: #fff; --text: #444; --success: #6b8e6b; --danger: #a95c5c; --warning: #b39e6b; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }

        /* Sidebar & Layout */
        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #3a3530; color: white; padding: 20px 0; z-index: 1000; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #4a433b; margin-bottom: 20px; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; border-left: 4px solid transparent; display: block; text-decoration: none; color: white; }
        .menu-item:hover, .menu-item.active { background: #4a433b; border-left-color: var(--primary); }
        .main-content { margin-left: 250px; padding: 30px; }

        /* Components */
        .header { background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .header h1 { color: var(--primary); font-size: 2em; margin-bottom: 5px; }
        .card { background: var(--card); border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #6d5f53; transform: translateY(-2px); }

        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 10px; max-height: 500px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: var(--primary); color: white; padding: 15px; text-align: left; font-size: 0.9rem; white-space: nowrap; position: sticky; top: 0; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        tr:hover { background: #f5f2ed; }

        .badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .badge-sv { background: #e3f2fd; color: #1565c0; } /* Sinh vi√™n */
        .badge-cb { background: #e8f5e9; color: #2e7d32; } /* C√°n b·ªô */
        .badge-admin { background: #fff3e0; color: #ef6c00; } /* Admin */

        .action-btn { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px; }
        .edit { background: #fff8e1; color: #fbc02d; }
        .delete { background: #ffebee; color: #c62828; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 2% auto; padding: 30px; border-radius: 15px; width: 95%; max-width: 1000px; max-height: 90vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; cursor: pointer; }

        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        
        .section-title { grid-column: span 3; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 20px; font-weight: bold; }
        .hidden { display: none; }
        .stt-label { color: #08f6da; font-weight: 900; margin-right: 5px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header"><h2>üéì UTE Admin</h2></div>
        <a href="nguoidung.html" class="menu-item active">üë• Ng∆∞·ªùi d√πng</a>
        <a href="hocky.html" class="menu-item">üìÖ H·ªçc k·ª≥</a>
        <a href="hocbong.html" class="menu-item">üí∞ H·ªçc b·ªïng</a>
        <a href="../TrangChu/index.html" class="menu-item" style="margin-top: 20px; border-top: 1px solid #555;">üö™ Tho√°t</a>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>üë• Qu·∫£n l√Ω T√†i kho·∫£n</h1>
            <p>Qu·∫£n l√Ω t√†i kho·∫£n ƒëƒÉng nh·∫≠p, th√¥ng tin Sinh vi√™n v√† C√°n b·ªô.</p>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>üìã Danh s√°ch T√†i kho·∫£n</h2>
                <button class="btn btn-primary" onclick="openModal()">‚ûï T·∫°o m·ªõi t√†i kho·∫£n</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><span class="stt-label">1.</span>T√™n ƒêƒÉng Nh·∫≠p</th>
                            <th><span class="stt-label">2.</span>M·∫≠t Kh·∫©u</th>
                            <th><span class="stt-label">3.</span>Vai Tr√≤</th>
                            <th><span class="stt-label">4.</span>H·ªç T√™n</th>
                            <th><span class="stt-label">5.</span>Email</th>
                            <th><span class="stt-label">6.</span>SƒêT</th>
                            <th><span class="stt-label">8/13/14.</span>Th√¥ng tin chi ti·∫øt (L·ªõp/Khoa/ƒê∆°n v·ªã)</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color: var(--primary);">T·∫°o m·ªõi T√†i kho·∫£n</h2>
            
            <form id="formUser">
                <input type="hidden" id="editIndex">
                
                <div class="section-title">I. Th√¥ng tin T√†i kho·∫£n (B·∫£ng TaiKhoan)</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label><span class="stt-label">1.</span>T√™n ƒêƒÉng Nh·∫≠p <span style="color:red">*</span></label>
                        <input type="text" id="tenDangNhap" required placeholder="VD: SV001">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">2.</span>M·∫≠t Kh·∫©u <span style="color:red">*</span></label>
                        <input type="text" id="matKhau" required value="123">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">3.</span>Vai Tr√≤ <span style="color:red">*</span></label>
                        <select id="maVaiTro" onchange="toggleFormFields()" required>
                            <option value="">-- Ch·ªçn vai tr√≤ --</option>
                            <option value="SV">Sinh Vi√™n (SV)</option>
                            <option value="KHOA">Gi√°o v·ª• Khoa (KHOA)</option>
                            <option value="PDT">Ph√≤ng ƒê√†o T·∫°o (PDT)</option>
                            <option value="CTSV">Ph√≤ng CTSV (CTSV)</option>
                            <option value="ADMIN">Qu·∫£n Tr·ªã Vi√™n (ADMIN)</option>
                        </select>
                    </div>
                </div>

                <div class="section-title">II. Th√¥ng tin C√° nh√¢n (B·∫£ng SinhVien / CanBo)</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label><span class="stt-label">4.</span>H·ªç T√™n <span style="color:red">*</span></label>
                        <input type="text" id="hoTen" required placeholder="VD: Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">5.</span>Email</label>
                        <input type="email" id="email" placeholder="email@ute.edu.vn">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">6.</span>S·ªë ƒêi·ªán Tho·∫°i</label>
                        <input type="text" id="sdt" placeholder="090...">
                    </div>
                </div>

                <div id="sectionSV" class="hidden">
                    <div class="section-title">III. Th√¥ng tin Sinh Vi√™n (B·∫£ng SinhVien)</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label><span class="stt-label">7.</span>M√£ SV <span style="color:red">*</span></label>
                            <input type="text" id="maSV" placeholder="Tr√πng t√™n ƒëƒÉng nh·∫≠p">
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">8.</span>L·ªõp <span style="color:red">*</span></label>
                            <select id="maLop">
                                <option value="">-- Ch·ªçn l·ªõp --</option>
                                <option value="21DTHC1">21DTHC1 (CNTT)</option>
                                <option value="21DTHC2">21DTHC2 (CNTT)</option>
                                <option value="21CK01">21CK01 (C∆° Kh√≠)</option>
                                <option value="21DTHD1">21DTHD1 (ƒêi·ªán)</option>
                                <option value="21DTHH1">21DTHH1 (H√≥a)</option>
                                <option value="21DTHX1">21DTHX1 (X√¢y D·ª±ng)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">9.</span>Ng√†y Sinh</label>
                            <input type="date" id="ngaySinh">
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">10.</span>Gi·ªõi T√≠nh</label>
                            <select id="gioiTinh">
                                <option value="Nam">Nam</option>
                                <option value="N·ªØ">N·ªØ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="sectionCB" class="hidden">
                    <div class="section-title">III. Th√¥ng tin C√°n B·ªô (B·∫£ng CanBo)</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label><span class="stt-label">11.</span>M√£ C√°n B·ªô <span style="color:red">*</span></label>
                            <input type="text" id="maCB" placeholder="VD: CB001">
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">12.</span>Ch·ª©c V·ª•</label>
                            <input type="text" id="chucVu" placeholder="VD: Gi√°o v·ª•, Tr∆∞·ªüng ph√≤ng">
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">13.</span>ƒê∆°n V·ªã</label>
                            <input type="text" id="donVi" placeholder="VD: P.CTSV, Khoa CNS">
                        </div>
                        <div class="form-group">
                            <label><span class="stt-label">14.</span>M√£ Khoa (N·∫øu l√† Gi√°o v·ª•)</label>
                            <select id="maKhoaCB">
                                <option value="">-- Kh√¥ng thu·ªôc khoa --</option>
                                <option value="CNS">C√¥ng ngh·ªá s·ªë</option>
                                <option value="CK">C∆° kh√≠</option>
                                <option value="XD">X√¢y d·ª±ng</option>
                                <option value="DDT">ƒêi·ªán - ƒêi·ªán t·ª≠</option>
                                <option value="HHMT">H√≥a h·ªçc & M√¥i tr∆∞·ªùng</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" style="background: #ccc; margin-right: 10px;" onclick="closeModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u D·ªØ Li·ªáu</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- D·ªÆ LI·ªÜU M·∫™U (ƒê∆∞·ª£c convert t·ª´ SQL Insert) ---
        let userList = [
            // Sinh vi√™n
            { tenDN: 'SV001', matKhau: '123', vaiTro: 'SV', hoTen: 'Nguy·ªÖn VƒÉn An', email: 'an.nv@ute.edu.vn', sdt: '0912345678', maSV: 'SV001', maLop: '21DTHC1', ngaySinh: '2003-02-15', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV002', matKhau: '123', vaiTro: 'SV', hoTen: 'L√™ Th·ªã B√¨nh', email: 'binh.lt@ute.edu.vn', sdt: '0987654321', maSV: 'SV002', maLop: '21DTHC1', ngaySinh: '2002-09-20', gioiTinh: 'N·ªØ', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV003', matKhau: '123', vaiTro: 'SV', hoTen: 'Ph·∫°m VƒÉn Ch√≠', email: 'chi.pv@ute.edu.vn', sdt: '0909222333', maSV: 'SV003', maLop: '21CK01', ngaySinh: '2003-06-10', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV004', matKhau: '123', vaiTro: 'SV', hoTen: 'V√µ VƒÉn D≈©ng', email: 'dung.vv@ute.edu.vn', sdt: '0977888999', maSV: 'SV004', maLop: '21DTHD1', ngaySinh: '2002-12-01', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV005', matKhau: '123', vaiTro: 'SV', hoTen: 'Tr·∫ßn Th·ªã Hoa', email: 'hoa.tt@ute.edu.vn', sdt: '0911777333', maSV: 'SV005', maLop: '21DTHH1', ngaySinh: '2003-09-05', gioiTinh: 'N·ªØ', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV006', matKhau: '123', vaiTro: 'SV', hoTen: 'Ng√¥ VƒÉn Kh√°nh', email: 'khanh.nv@ute.edu.vn', sdt: '0909555777', maSV: 'SV006', maLop: '21CK01', ngaySinh: '2002-04-12', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV007', matKhau: '123', vaiTro: 'SV', hoTen: 'ƒêinh Th·ªã Lan', email: 'lan.dt@ute.edu.vn', sdt: '0911666888', maSV: 'SV007', maLop: '21DTHX1', ngaySinh: '2003-08-18', gioiTinh: 'N·ªØ', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV008', matKhau: '123', vaiTro: 'SV', hoTen: 'Phan VƒÉn Minh', email: 'minh.pv@ute.edu.vn', sdt: '0909333444', maSV: 'SV008', maLop: '21DTHC1', ngaySinh: '2003-11-25', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV009', matKhau: '123', vaiTro: 'SV', hoTen: 'Ho√†ng VƒÉn H√πng', email: 'hung.hv@ute.edu.vn', sdt: '0912345679', maSV: 'SV009', maLop: '21DTHC2', ngaySinh: '2003-03-10', gioiTinh: 'Nam', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            { tenDN: 'SV010', matKhau: '123', vaiTro: 'SV', hoTen: 'Ph·∫°m Th·ªã Mai', email: 'mai.pt@ute.edu.vn', sdt: '0987654322', maSV: 'SV010', maLop: '21DTHC2', ngaySinh: '2003-07-22', gioiTinh: 'N·ªØ', maCB: '', chucVu: '', donVi: '', maKhoa: '' },
            
            // C√°n b·ªô
            { tenDN: 'khoa_cns', matKhau: '123', vaiTro: 'KHOA', hoTen: 'Ng√¥ Th·ªã Lan', email: 'lan.nt@ute.edu.vn', sdt: '0911222333', maSV: '', maLop: '', ngaySinh: '', gioiTinh: '', maCB: 'CB002', chucVu: 'Gi√°o v·ª•', donVi: 'Khoa CNS', maKhoa: 'CNS' },
            { tenDN: 'khoa_ck', matKhau: '123', vaiTro: 'KHOA', hoTen: 'L√™ VƒÉn T√†i', email: 'tai.lv@ute.edu.vn', sdt: '0911444555', maSV: '', maLop: '', ngaySinh: '', gioiTinh: '', maCB: 'CB003', chucVu: 'Gi√°o v·ª•', donVi: 'Khoa CK', maKhoa: 'CK' },
            { tenDN: 'daotao', matKhau: '123', vaiTro: 'PDT', hoTen: 'Ph·∫°m Thu H∆∞∆°ng', email: 'huong.pt@ute.edu.vn', sdt: '0911777888', maSV: '', maLop: '', ngaySinh: '', gioiTinh: '', maCB: 'CB005', chucVu: 'Tr∆∞·ªüng ph√≤ng', donVi: 'P. ƒê√†o t·∫°o', maKhoa: '' },
            { tenDN: 'ctsv', matKhau: '123', vaiTro: 'CTSV', hoTen: 'Tr·∫ßn VƒÉn Minh', email: 'minh.tv@ute.edu.vn', sdt: '0911111111', maSV: '', maLop: '', ngaySinh: '', gioiTinh: '', maCB: 'CB001', chucVu: 'Tr∆∞·ªüng ph√≤ng', donVi: 'P.CTSV', maKhoa: '' },
            { tenDN: 'admin', matKhau: '123', vaiTro: 'ADMIN', hoTen: 'Nguy·ªÖn VƒÉn H√πng', email: 'hung.nv@ute.edu.vn', sdt: '0911666777', maSV: '', maLop: '', ngaySinh: '', gioiTinh: '', maCB: 'CB004', chucVu: 'Hi·ªáu tr∆∞·ªüng', donVi: 'Ban Gi√°m hi·ªáu', maKhoa: '' }
        ];

        function toggleFormFields() {
            const role = document.getElementById('maVaiTro').value;
            const secSV = document.getElementById('sectionSV');
            const secCB = document.getElementById('sectionCB');

            secSV.classList.add('hidden');
            secCB.classList.add('hidden');

            if (role === 'SV') {
                secSV.classList.remove('hidden');
                // T·ª± ƒë·ªông ƒëi·ªÅn M√£ SV gi·ªëng T√™n ƒëƒÉng nh·∫≠p
                document.getElementById('maSV').value = document.getElementById('tenDangNhap').value;
            } else if (role !== '') {
                secCB.classList.remove('hidden');
            }
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            userList.forEach((u, i) => {
                let roleBadge = u.vaiTro === 'SV' ? 'badge-sv' : (u.vaiTro === 'ADMIN' ? 'badge-admin' : 'badge-cb');
                let infoDetail = u.vaiTro === 'SV' ? `L·ªõp: ${u.maLop}` : `${u.chucVu} - ${u.donVi}`;
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${u.tenDN}</strong></td>
                        <td>***</td>
                        <td><span class="badge ${roleBadge}">${u.vaiTro}</span></td>
                        <td>${u.hoTen}</td>
                        <td>${u.email}</td>
                        <td>${u.sdt}</td>
                        <td>${infoDetail}</td>
                        <td>
                            <button class="action-btn edit" onclick="editItem(${i})">‚úèÔ∏è</button>
                            <button class="action-btn delete" onclick="deleteItem(${i})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function openModal() {
            document.getElementById('formUser').reset();
            document.getElementById('editIndex').value = '-1';
            document.getElementById('modalTitle').innerText = 'T·∫°o m·ªõi T√†i kho·∫£n';
            document.getElementById('tenDangNhap').disabled = false;
            toggleFormFields();
            document.getElementById('modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function editItem(index) {
            const u = userList[index];
            document.getElementById('editIndex').value = index;
            
            // Fill common
            document.getElementById('tenDangNhap').value = u.tenDN;
            document.getElementById('tenDangNhap').disabled = true; // PK
            document.getElementById('matKhau').value = u.matKhau;
            document.getElementById('maVaiTro').value = u.vaiTro;
            document.getElementById('hoTen').value = u.hoTen;
            document.getElementById('email').value = u.email;
            document.getElementById('sdt').value = u.sdt;

            toggleFormFields();

            // Fill detail
            if (u.vaiTro === 'SV') {
                document.getElementById('maSV').value = u.maSV;
                document.getElementById('maLop').value = u.maLop;
                document.getElementById('ngaySinh').value = u.ngaySinh;
                document.getElementById('gioiTinh').value = u.gioiTinh;
            } else {
                document.getElementById('maCB').value = u.maCB;
                document.getElementById('chucVu').value = u.chucVu;
                document.getElementById('donVi').value = u.donVi;
                document.getElementById('maKhoaCB').value = u.maKhoa;
            }

            document.getElementById('modalTitle').innerText = 'C·∫≠p Nh·∫≠t T√†i Kho·∫£n';
            document.getElementById('modal').style.display = 'block';
        }

        function deleteItem(index) {
            if(confirm('X√≥a t√†i kho·∫£n n√†y?')) {
                userList.splice(index, 1);
                renderTable();
            }
        }

        document.getElementById('formUser').addEventListener('submit', function(e) {
            e.preventDefault();
            const idx = document.getElementById('editIndex').value;
            const role = document.getElementById('maVaiTro').value;

            const data = {
                tenDN: document.getElementById('tenDangNhap').value,
                matKhau: document.getElementById('matKhau').value,
                vaiTro: role,
                hoTen: document.getElementById('hoTen').value,
                email: document.getElementById('email').value,
                sdt: document.getElementById('sdt').value,
                // SV fields
                maSV: role === 'SV' ? document.getElementById('maSV').value : '',
                maLop: role === 'SV' ? document.getElementById('maLop').value : '',
                ngaySinh: role === 'SV' ? document.getElementById('ngaySinh').value : '',
                gioiTinh: role === 'SV' ? document.getElementById('gioiTinh').value : '',
                // CB fields
                maCB: role !== 'SV' ? document.getElementById('maCB').value : '',
                chucVu: role !== 'SV' ? document.getElementById('chucVu').value : '',
                donVi: role !== 'SV' ? document.getElementById('donVi').value : '',
                maKhoa: role !== 'SV' ? document.getElementById('maKhoaCB').value : ''
            };

            if(idx == '-1') {
                if(userList.some(u => u.tenDN === data.tenDN)) {
                    alert('T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
                    return;
                }
                userList.push(data);
            } else {
                userList[idx] = data;
            }
            closeModal();
            renderTable();
        });

        window.onclick = function(event) {
            if (event.target == document.getElementById('modal')) closeModal();
        }

        renderTable();
    </script>
</body>
</html>