<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω H·ªçc b·ªïng - UTE Admin</title>
    <style>
        :root { --primary: #8c7a6b; --bg: #d9d2c7; --card: #fff; --text: #444; --success: #6b8e6b; --danger: #a95c5c; --warning: #b39e6b; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }

        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #3a3530; color: white; padding: 20px 0; z-index: 1000; transition: transform 0.3s; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #4a433b; margin-bottom: 20px; }
        .menu-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; border-left: 4px solid transparent; display: block; text-decoration: none; color: white; }
        .menu-item:hover, .menu-item.active { background: #4a433b; border-left-color: var(--primary); }
        .main-content { margin-left: 250px; padding: 30px; }

        .header { background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .header h1 { color: var(--primary); font-size: 2em; margin-bottom: 5px; }
        .card { background: var(--card); border-radius: 15px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #6d5f53; transform: translateY(-2px); }

        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: var(--primary); color: white; padding: 15px; text-align: left; font-size: 0.9rem; white-space: nowrap; }
        td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        tr:hover { background: #f5f2ed; }

        .badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .badge-kk { background: #e8f5e9; color: #2e7d32; }
        .badge-tt { background: #fff3e0; color: #ef6c00; }
        .badge-dn { background: #e3f2fd; color: #1565c0; }

        .action-btn { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px; }
        .edit { background: #fff8e1; color: #fbc02d; }
        .delete { background: #ffebee; color: #c62828; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 2% auto; padding: 30px; border-radius: 15px; width: 95%; max-width: 1000px; max-height: 90vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; cursor: pointer; }

        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .form-group textarea { height: 80px; resize: vertical; }
        
        .disabled-field { background-color: #f0f0f0; cursor: not-allowed; }
        .stt-label { color: #08f6da; font-weight: 900; margin-right: 5px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header"><h2>üéì UTE Admin</h2></div>
        <a href="nguoidung.html" class="menu-item">üë• Ng∆∞·ªùi d√πng</a>
        <a href="hocky.html" class="menu-item">üìÖ H·ªçc k·ª≥</a>
        <a href="hocbong.html" class="menu-item active">üí∞ H·ªçc b·ªïng</a>
        <a href="../TrangChu/index.html" class="menu-item" style="margin-top: 20px; border-top: 1px solid #555;">üö™ Tho√°t</a>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>üí∞ Qu·∫£n l√Ω Ti√™u ch√≠ H·ªçc b·ªïng</h1>
            <p>Thi·∫øt l·∫≠p ti√™u ch√≠, ƒëi·ªÅu ki·ªán v√† th·ªùi gian cho c√°c ƒë·ª£t x√©t h·ªçc b·ªïng.</p>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>üìã Danh s√°ch Ti√™u ch√≠</h2>
                <button class="btn btn-primary" onclick="openModal()">‚ûï Th√™m Ti√™u Ch√≠ M·ªõi</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><span class="stt-label">1.</span>M√£ TC</th>
                            <th><span class="stt-label">2.</span>T√™n Ti√™u Ch√≠</th>
                            <th><span class="stt-label">3.</span>Lo·∫°i</th>
                            <th><span class="stt-label">4.</span>H·ªçc K·ª≥</th>
                            <th><span class="stt-label">5.</span>DN T√†i Tr·ª£</th>
                            <th><span class="stt-label">6/7/8.</span>ƒêi·ªÅu ki·ªán (GPA/ƒêRL/ƒêHƒê)</th>
                            <th><span class="stt-label">9/10.</span>Su·∫•t/Ti·ªÅn</th>
                            <th><span class="stt-label">11/12.</span>Th·ªùi gian</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color: var(--primary);">Th√™m Ti√™u Ch√≠ H·ªçc B·ªïng</h2>
            
            <form id="formCriteria">
                <input type="hidden" id="editIndex">
                
                <h4 style="margin-bottom: 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px;">I. Th√¥ng tin chung</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label><span class="stt-label">1.</span>M√£ ti√™u ch√≠ <span style="color:red">*</span></label>
                        <input type="text" id="maTC" required placeholder="VD: HBKK_242">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label><span class="stt-label">2.</span>T√™n ti√™u ch√≠ <span style="color:red">*</span></label>
                        <input type="text" id="tenTC" required placeholder="VD: H·ªçc b·ªïng Khuy·∫øn kh√≠ch HK2 2024-2025">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">3.</span>Lo·∫°i h·ªçc b·ªïng <span style="color:red">*</span></label>
                        <select id="loaiHB" onchange="toggleFields()" required>
                            <option value="KhuyenKhich">Khuy·∫øn kh√≠ch</option>
                            <option value="ThuThach">Th·ª≠ th√°ch</option>
                            <option value="DoanhNghiep">Doanh nghi·ªáp</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">4.</span>H·ªçc k·ª≥ √°p d·ª•ng</label>
                        <select id="maHK">
                            <option value="HK2_2425">H·ªçc k·ª≥ 2 (2024-2025)</option>
                            <option value="HK1_2425">H·ªçc k·ª≥ 1 (2024-2025)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">5.</span>Doanh nghi·ªáp (N·∫øu c√≥)</label>
                        <select id="maDN" disabled class="disabled-field">
                            <option value="">-- Kh√¥ng √°p d·ª•ng --</option>
                            <option value="DN001">FPT Software</option>
                            <option value="DN002">Viettel</option>
                        </select>
                    </div>
                </div>

                <h4 style="margin-top: 20px; margin-bottom: 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px;">II. ƒêi·ªÅu ki·ªán & ƒê·ªãnh m·ª©c</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label><span class="stt-label">6.</span>GPA T·ªëi thi·ªÉu</label>
                        <input type="number" id="gpaMin" step="0.01" min="0" max="4" placeholder="VD: 3.2">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">7.</span>ƒêRL T·ªëi thi·ªÉu</label>
                        <input type="number" id="drlMin" min="0" max="100" placeholder="VD: 80">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">8.</span>ƒêHƒê T·ªëi thi·ªÉu</label>
                        <input type="number" id="dhdMin" min="0" placeholder="VD: 10">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">9.</span>S·ªë l∆∞·ª£ng su·∫•t</label>
                        <input type="number" id="soLuong" min="1" placeholder="VD: 50">
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">10.</span>M·ª©c h·ªçc b·ªïng (VNƒê)</label>
                        <input type="number" id="mucHB" min="0" placeholder="VD: 5000000">
                    </div>
                </div>

                <h4 style="margin-top: 20px; margin-bottom: 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px;">III. Th·ªùi gian & Kh√°c</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label><span class="stt-label">11.</span>Ng√†y b·∫Øt ƒë·∫ßu</label>
                        <input type="date" id="ngayBd" required>
                    </div>
                    <div class="form-group">
                        <label><span class="stt-label">12.</span>Ng√†y k·∫øt th√∫c</label>
                        <input type="date" id="ngayKt" required>
                    </div>
                    <div class="form-group" style="grid-column: span 3;">
                        <label><span class="stt-label">13.</span>Ghi ch√∫ / ƒêi·ªÅu ki·ªán kh√°c</label>
                        <textarea id="ghiChu" placeholder="VD: ∆Øu ti√™n sinh vi√™n c√≥ ho√†n c·∫£nh kh√≥ khƒÉn..."></textarea>
                    </div>
                </div>

                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" style="background: #ccc; margin-right: 10px;" onclick="closeModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u D·ªØ Li·ªáu</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu m·∫´u
        let criteriaList = [
            { maTC: 'HBKK_HK2_A', tenTC: 'HBKK Xu·∫•t S·∫Øc HK2 24-25', loaiHB: 'KhuyenKhich', maHK: 'HK2_2425', maDN: '', gpa: 3.6, drl: 90, dhd: 15, sl: 20, tien: 5000000, start: '2025-05-01', end: '2025-05-30', gc: '' },
            { maTC: 'HBDN_FPT', tenTC: 'H·ªçc b·ªïng FPT Talent', loaiHB: 'DoanhNghiep', maHK: 'HK2_2425', maDN: 'DN001', gpa: 3.2, drl: 80, dhd: 10, sl: 5, tien: 10000000, start: '2025-06-01', end: '2025-06-30', gc: 'Y√™u c·∫ßu ti·∫øng Anh t·ªët' }
        ];

        function formatMoney(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        function toggleFields() {
            const type = document.getElementById('loaiHB').value;
            const dnSelect = document.getElementById('maDN');
            
            if (type === 'DoanhNghiep') {
                dnSelect.disabled = false;
                dnSelect.classList.remove('disabled-field');
                dnSelect.setAttribute('required', 'required');
            } else {
                dnSelect.value = "";
                dnSelect.disabled = true;
                dnSelect.classList.add('disabled-field');
                dnSelect.removeAttribute('required');
            }
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            criteriaList.forEach((item, index) => {
                let badgeClass = item.loaiHB === 'KhuyenKhich' ? 'badge-kk' : (item.loaiHB === 'ThuThach' ? 'badge-tt' : 'badge-dn');
                let dnInfo = item.maDN ? `<br><small style="color:blue">(${item.maDN})</small>` : '';
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${item.maTC}</strong></td>
                        <td>${item.tenTC}</td>
                        <td><span class="badge ${badgeClass}">${item.loaiHB}</span></td>
                        <td>${item.maHK}</td>
                        <td>${item.maDN || '-'}${dnInfo}</td>
                        <td>
                            GPA ‚â• <b>${item.gpa || '-'}</b><br>
                            ƒêRL ‚â• <b>${item.drl || '-'}</b><br>
                            ƒêHƒê ‚â• <b>${item.dhd || '-'}</b>
                        </td>
                        <td>
                            <b>${item.sl}</b> su·∫•t<br>
                            <span style="color:var(--danger)">${formatMoney(item.tien)}</span>
                        </td>
                        <td style="font-size:0.85rem">
                            ${item.start}<br>‚Üì<br>${item.end}
                        </td>
                        <td>
                            <button class="action-btn edit" onclick="editItem(${index})">‚úèÔ∏è</button>
                            <button class="action-btn delete" onclick="deleteItem(${index})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function openModal() {
            document.getElementById('formCriteria').reset();
            document.getElementById('editIndex').value = '-1';
            document.getElementById('modalTitle').innerText = 'Th√™m Ti√™u Ch√≠ M·ªõi';
            document.getElementById('maTC').disabled = false;
            toggleFields(); // Reset tr·∫°ng th√°i
            document.getElementById('modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function editItem(index) {
            const item = criteriaList[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('maTC').value = item.maTC;
            document.getElementById('maTC').disabled = true;
            document.getElementById('tenTC').value = item.tenTC;
            document.getElementById('loaiHB').value = item.loaiHB;
            toggleFields(); // C·∫≠p nh·∫≠t tr·∫°ng th√°i √¥ DN
            document.getElementById('maHK').value = item.maHK;
            document.getElementById('maDN').value = item.maDN;
            document.getElementById('gpaMin').value = item.gpa;
            document.getElementById('drlMin').value = item.drl;
            document.getElementById('dhdMin').value = item.dhd;
            document.getElementById('soLuong').value = item.sl;
            document.getElementById('mucHB').value = item.tien;
            document.getElementById('ngayBd').value = item.start;
            document.getElementById('ngayKt').value = item.end;
            document.getElementById('ghiChu').value = item.gc;
            
            document.getElementById('modalTitle').innerText = 'C·∫≠p Nh·∫≠t Ti√™u Ch√≠';
            document.getElementById('modal').style.display = 'block';
        }

        function deleteItem(index) {
            if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ti√™u ch√≠ n√†y?')) {
                criteriaList.splice(index, 1);
                renderTable();
            }
        }

        document.getElementById('formCriteria').addEventListener('submit', function(e) {
            e.preventDefault();
            const idx = document.getElementById('editIndex').value;
            const data = {
                maTC: document.getElementById('maTC').value,
                tenTC: document.getElementById('tenTC').value,
                loaiHB: document.getElementById('loaiHB').value,
                maHK: document.getElementById('maHK').value,
                maDN: document.getElementById('maDN').value,
                gpa: document.getElementById('gpaMin').value,
                drl: document.getElementById('drlMin').value,
                dhd: document.getElementById('dhdMin').value,
                sl: document.getElementById('soLuong').value,
                tien: document.getElementById('mucHB').value,
                start: document.getElementById('ngayBd').value,
                end: document.getElementById('ngayKt').value,
                gc: document.getElementById('ghiChu').value
            };

            if (new Date(data.start) > new Date(data.end)) {
                alert("Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i nh·ªè h∆°n ng√†y k·∫øt th√∫c!");
                return;
            }

            if(idx == '-1') {
                if(criteriaList.some(x => x.maTC === data.maTC)) {
                    alert('M√£ ti√™u ch√≠ ƒë√£ t·ªìn t·∫°i!');
                    return;
                }
                criteriaList.push(data);
            } else {
                criteriaList[idx] = data;
            }
            closeModal();
            renderTable();
        });

        window.onclick = function(event) {
            if (event.target == document.getElementById('modal')) closeModal();
        }

        renderTable();
    </script>
</body>
</html>